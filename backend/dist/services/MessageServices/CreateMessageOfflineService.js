'use strict';
const I = b, J = b;
(function (c, d) {
    const G = b, H = b, e = c();
    while (!![]) {
        try {
            const f = parseInt(G(0x1e9)) / (0x34b * 0x9 + 0x1772 + 0x9e * -0x56) * (parseInt(H(0x219)) / (-0x8e7 * -0x2 + 0x435 + 0x83 * -0x2b)) + -parseInt(G(0x1bd)) / (0x1dc5 + 0x209 * -0xe + 0x2 * -0xa2) * (parseInt(H(0x1d7)) / (0xc2 * -0x25 + 0x148c + -0x3c1 * -0x2)) + parseInt(G(0x201)) / (0x57a + 0x14cf * 0x1 + -0x1a44) + parseInt(H(0x1d5)) / (-0xfd0 + 0x1c4f * 0x1 + -0xc79) + -parseInt(G(0x1f6)) / (0xb3e + -0x1d7 * -0x4 + -0x1293) * (parseInt(H(0x1e2)) / (0x913 + -0x42e * 0x8 + 0x1865)) + parseInt(G(0x1df)) / (-0x2ac * -0x3 + 0x59 * -0x31 + 0x90e) * (-parseInt(G(0x1c2)) / (-0x92f + 0x1b7 * 0x2 + 0x1 * 0x5cb)) + parseInt(H(0x210)) / (-0x218 * -0xa + 0x192f * 0x1 + -0x7ae * 0x6);
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, -0xdb864 + -0x11decd + -0x5 * -0x939f2));
function a() {
    const P = [
        'quotedMsg',
        'writeFile',
        'buffer',
        '5770SSzCkX',
        'SXiFz',
        'vEqhA',
        '../../mode',
        'fault',
        'LrQNf',
        'public',
        'SMwHM',
        'map',
        '__importDe',
        'IHdnk',
        'ls/Message',
        'update',
        'error',
        'AOsdU',
        'ERR_CREATI',
        'timestamp',
        'okQpj',
        'KNsHi',
        '170646YMoPvh',
        '../../libs',
        '1264vqQZdW',
        'mediaType',
        'userId',
        'body',
        'fromMe',
        'join',
        'contactId',
        'promisify',
        '7470FWGWFI',
        'bXkYg',
        '../../util',
        '1581416QbqlCU',
        'split',
        'rciND',
        'OffLine',
        'toString',
        'erty',
        'fzRXN',
        '247831OawHOL',
        'value',
        'PpTXH',
        's/logger',
        'fwaqf',
        'mimetype',
        'status',
        'getIO',
        'CreateMess',
        'substr',
        'pfzgJ',
        '-appMessag',
        'VCPww',
        '14zPKugq',
        'sffFM',
        '-notificat',
        'lNEsa',
        'fHAsy',
        'NG_MESSAGE',
        'path',
        'indexOf',
        'ticketId',
        'chat',
        'IaeHp',
        '1271600LgTuvi',
        'GmjNB',
        'base64',
        'tenantId',
        'VkqRq',
        'default',
        'mediaUrl',
        'ion',
        'read',
        'contact',
        'wId',
        'ticket',
        'KjkyJ',
        'create',
        'KBqsf',
        '13669865PxZBZs',
        'XiOOG',
        'logger',
        'bOfun',
        'dlUWk',
        'pRznE',
        'Service',
        'ls/Ticket',
        'fjWDn',
        '14QuqtzG',
        'YRFgp',
        'GaypN',
        'ZqIjN',
        'IHxGu',
        'util',
        'JIRrT',
        'getTime',
        'all',
        '__esModule',
        'LLmSi',
        'findByPk',
        'include',
        'filename',
        'lyInX',
        'BCZpj',
        '/socket',
        'emit',
        'defineProp',
        '13605jRZHNq',
        'ageOffLine'
    ];
    a = function () {
        return P;
    };
    return a();
}
var __importDefault = this && this[I(0x1cb) + J(0x1c6)] || function (c) {
    const K = I;
    return c && c[K(0x1b3)] ? c : { 'default': c };
};
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (-0x1 * 0x1af7 + -0x6b0 + 0x9c * 0x3a);
        let h = e[f];
        return h;
    }, b(c, d);
}
const k = {};
k[I(0x1ea)] = !![], Object[J(0x1bc) + J(0x1e7)](exports, J(0x1b3), k);
const fs_1 = require('fs'), util_1 = require(J(0x21e)), path_1 = require(I(0x1fc)), logger_1 = require(I(0x1e1) + I(0x1ec)), MessageOffLine_1 = __importDefault(require(I(0x1c5) + I(0x1cd) + I(0x1e5))), socket_1 = require(I(0x1d6) + I(0x1ba)), Ticket_1 = __importDefault(require(I(0x1c5) + I(0x217))), Message_1 = __importDefault(require(J(0x1c5) + J(0x1cd))), writeFileAsync = (-0x335 + -0x16 * 0x44 + 0x90d, util_1[J(0x1de)])(fs_1[J(0x1c0)]), CreateMessageOffilineService = async ({
        msg: g,
        tenantId: h,
        medias: i,
        ticket: j,
        userId: l
    }) => {
        const L = J, M = J, m = {
                'fHAsy': L(0x1d1) + M(0x1fb),
                'LrQNf': M(0x1f1) + L(0x1be) + L(0x216),
                'pRznE': function (q, r) {
                    return q === r;
                },
                'IHxGu': L(0x1d3),
                'sffFM': L(0x202),
                'fwaqf': M(0x1c3),
                'GaypN': M(0x1b8),
                'lNEsa': function (q, r) {
                    return q !== r;
                },
                'fzRXN': L(0x1e4),
                'AOsdU': M(0x214),
                'YRFgp': function (q, r, s, t) {
                    return q(r, s, t);
                },
                'ZqIjN': M(0x1c8),
                'PpTXH': L(0x203),
                'pfzgJ': M(0x213),
                'BCZpj': L(0x20a),
                'bXkYg': M(0x20c),
                'KBqsf': M(0x1bf),
                'XiOOG': function (q, r) {
                    return q !== r;
                },
                'LLmSi': L(0x205),
                'fjWDn': L(0x1f5),
                'KNsHi': M(0x20e),
                'KjkyJ': L(0x1ff),
                'SMwHM': M(0x21f),
                'IaeHp': L(0x1c4)
            }, n = (-0x1 * 0xc41 + 0x2ed * -0x1 + 0xf2e, socket_1[M(0x1f0)])(), o = {};
        o[M(0x20b)] = undefined, o[L(0x1fe)] = j['id'], o[M(0x1da)] = g[L(0x1da)], o[L(0x1dd)] = j[M(0x1dd)], o[L(0x1db)] = g[M(0x1db)], o[L(0x209)] = !![], o[M(0x1d8)] = m[M(0x20d)], o[M(0x207)] = undefined, o[M(0x1d2)] = undefined, o[M(0x1d9)] = l;
        const p = o;
        try {
            if (i)
                m[L(0x215)](m[M(0x1c9)], m[L(0x200)]) ? e[L(0x212)][M(0x1cf)](f) : await Promise[M(0x1b2)](i[M(0x1ca)](async r => {
                    const N = M, O = L, s = {};
                    s[N(0x1cc)] = m[O(0x1c7)];
                    const t = s;
                    if (m[O(0x215)](m[N(0x21d)], m[N(0x1f7)]))
                        e[O(0x212)][O(0x1cf)](t[N(0x1cc)], f);
                    else {
                        try {
                            if (m[N(0x215)](m[O(0x1ed)], m[O(0x21b)])) {
                                const B = y[N(0x1ee)][O(0x1e3)]('/')[-0x6a1 * 0x3 + -0x1fca + 0x33ae][N(0x1e3)](';')[-0x1bfa + -0xb * 0x99 + 0x228d];
                                g[O(0x1b7)] = new h()[N(0x1b1)]() + '.' + B;
                            } else {
                                if (!r[O(0x1b7)]) {
                                    if (m[O(0x1f9)](m[O(0x1e8)], m[N(0x1d0)])) {
                                        const B = r[N(0x1ee)][O(0x1e3)]('/')[0xfc8 * -0x1 + -0x3 * -0x593 + -0x28 * 0x6][O(0x1e3)](';')[0x299 * -0xb + 0x1c0d + 0x43 * 0x2];
                                        r[O(0x1b7)] = new Date()[N(0x1b1)]() + '.' + B;
                                    } else
                                        throw new s(m[N(0x1fa)]);
                                }
                                await m[N(0x21a)](writeFileAsync, (0x1cb3 + -0x1a7b + 0x8 * -0x47, path_1[N(0x1dc)])(__dirname, '..', '..', '..', '..', m[O(0x21c)], r[O(0x1b7)]), r[N(0x1c1)], m[N(0x1eb)]);
                            }
                        } catch (D) {
                            if (m[O(0x215)](m[N(0x1f3)], m[N(0x1f3)]))
                                logger_1[O(0x212)][O(0x1cf)](D);
                            else {
                                const F = {};
                                return F[O(0x206)] = j, g && h[O(0x1b3)] ? i : F;
                            }
                        }
                        const v = {
                                ...p,
                                'mediaUrl': r[O(0x1b7)],
                                'mediaType': r[N(0x1ee)][N(0x1f2)](0x1 * 0x6dc + 0x2303 * 0x1 + 0x1b * -0x18d, r[N(0x1ee)][O(0x1fd)]('/'))
                            }, w = await MessageOffLine_1[N(0x206)][O(0x20e)](v), x = {};
                        x[O(0x204)] = h;
                        const y = {};
                        y[N(0x1b6)] = [
                            m[N(0x1b9)],
                            {
                                'model': Ticket_1[O(0x206)],
                                'as': m[N(0x1e0)],
                                'where': x,
                                'include': [m[O(0x1b9)]]
                            },
                            {
                                'model': Message_1[N(0x206)],
                                'as': m[O(0x20f)],
                                'include': [m[O(0x1b9)]]
                            }
                        ];
                        const z = await MessageOffLine_1[O(0x206)][O(0x1b5)](w['id'], y);
                        if (!z) {
                            if (m[N(0x211)](m[O(0x1b4)], m[O(0x218)]))
                                throw new Error(m[O(0x1fa)]);
                            else
                                throw new s(m[N(0x1fa)]);
                        }
                        n['to'](h + '-' + z[N(0x1fe)][O(0x1e6)]())['to'](h + '-' + z[O(0x20c)][N(0x1ef)])['to'](h + (N(0x1f8) + O(0x208)))[O(0x1bb)](h + (N(0x1f4) + 'e'), {
                            'action': m[N(0x1d4)],
                            'message': z,
                            'ticket': z[N(0x20c)],
                            'contact': z[N(0x20c)][N(0x20a)]
                        }), await j[N(0x1ce)]({
                            'lastMessage': z[O(0x1da)],
                            'lastMessageAt': new Date()[O(0x1b1)]()
                        });
                    }
                }));
            else {
                const r = { ...p };
                r[L(0x1d8)] = m[M(0x20d)];
                const s = await MessageOffLine_1[L(0x206)][M(0x20e)](r), t = {};
                t[M(0x204)] = h;
                const u = {};
                u[M(0x1b6)] = [
                    m[L(0x1b9)],
                    {
                        'model': Ticket_1[M(0x206)],
                        'as': m[L(0x1e0)],
                        'where': t,
                        'include': [m[M(0x1b9)]]
                    },
                    {
                        'model': Message_1[M(0x206)],
                        'as': m[L(0x20f)],
                        'include': [m[L(0x1b9)]]
                    }
                ];
                const v = await MessageOffLine_1[L(0x206)][L(0x1b5)](s['id'], u);
                if (!v)
                    throw new Error(m[L(0x1fa)]);
                await j[M(0x1ce)]({
                    'lastMessage': v[M(0x1da)],
                    'lastMessageAt': new Date()[M(0x1b1)]()
                }), n['to'](h + '-' + v[L(0x1fe)][M(0x1e6)]())['to'](h + '-' + v[M(0x20c)][M(0x1ef)])['to'](h + (M(0x1f8) + M(0x208)))[L(0x1bb)](h + (M(0x1f4) + 'e'), {
                    'action': m[M(0x1d4)],
                    'message': v,
                    'ticket': v[L(0x20c)],
                    'contact': v[L(0x20c)][M(0x20a)]
                });
            }
        } catch (w) {
            logger_1[M(0x212)][M(0x1cf)](m[M(0x1c7)], w);
        }
    };
exports[I(0x206)] = CreateMessageOffilineService;
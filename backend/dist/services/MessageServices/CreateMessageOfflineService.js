'use strict';
const H = b, I = b;
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (0x2f1 + -0x1 * -0x2473 + 0x259f * -0x1);
        let h = e[f];
        return h;
    }, b(c, d);
}
(function (c, d) {
    const F = b, G = b, e = c();
    while (!![]) {
        try {
            const f = parseInt(F(0x1e7)) / (-0x14c * 0x16 + 0xbd8 + 0x10b1) + -parseInt(G(0x20f)) / (-0x1 * 0x16e5 + -0x9b0 + 0x2097) + -parseInt(F(0x1e8)) / (-0x3d * 0xa3 + -0x25c1 * 0x1 + 0x883 * 0x9) * (-parseInt(F(0x223)) / (0x1 * -0x1ae3 + 0x207b + 0xee * -0x6)) + parseInt(G(0x1d3)) / (0xa3 * -0x1 + 0x445 * -0x7 + 0x7 * 0x45d) + parseInt(G(0x1ef)) / (0xa * -0xa8 + -0x5 * 0x5f7 + 0x2469) + -parseInt(G(0x215)) / (-0xc97 + 0x5 * 0x685 + -0x155 * 0xf) + parseInt(G(0x1f3)) / (0x2 * 0x2a4 + -0xe26 * -0x1 + -0x1366) * (parseInt(G(0x1e6)) / (-0xc46 + -0x1ead + 0x2afc));
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, 0x18f835 + 0x47 * -0x5ecc + 0x106351));
function a() {
    const O = [
        'tNYWG',
        'ageOffLine',
        'timestamp',
        'all',
        'NAXGu',
        'FepoS',
        'body',
        'findByPk',
        '../../util',
        'NLbBz',
        'wId',
        'error',
        'path',
        'writeFile',
        'OffLine',
        '996984ocKgGy',
        '361594WTokaT',
        '3gSfQkw',
        '../../mode',
        'contact',
        'getIO',
        'dZwXb',
        'bKpLz',
        'explF',
        '1591260IlWwHi',
        'ElYoX',
        '-appMessag',
        'SCwpL',
        '224FwWFTJ',
        'IKaSS',
        'defineProp',
        'KjjFM',
        'quotedMsg',
        'value',
        'XaaUP',
        'emit',
        'join',
        'BIZJw',
        'substr',
        's/logger',
        'create',
        'mediaUrl',
        '-notificat',
        'contactId',
        'XbryA',
        'Service',
        'tenantId',
        'ERR_CREATI',
        'filename',
        'update',
        'public',
        'xXNPu',
        'ls/Message',
        'userId',
        'default',
        'ItVUI',
        '3733976whcsOo',
        'nxXeK',
        '/socket',
        'promisify',
        '__importDe',
        'erty',
        '11879035duCGYV',
        'RCmjD',
        'buffer',
        'wKlpc',
        'fromMe',
        'bnlXo',
        'base64',
        'chat',
        'NG_MESSAGE',
        'ticket',
        'map',
        'getTime',
        'ls/Ticket',
        'split',
        '530548ZvrfTE',
        'plfqf',
        'fault',
        'mimetype',
        '../../libs',
        'mediaType',
        'Njhoa',
        'read',
        'Shkqk',
        'KLUUD',
        'idwqO',
        'PNNxu',
        'toString',
        'IEluM',
        'uGPlH',
        'ion',
        'dZuXn',
        'status',
        'CreateMess',
        'indexOf',
        'stwsd',
        'ticketId',
        '__esModule',
        'logger',
        'util',
        'QwQdu',
        '3451010ZljWVm',
        'oDcnN',
        'include',
        'ZodkH'
    ];
    a = function () {
        return O;
    };
    return a();
}
var __importDefault = this && this[H(0x213) + I(0x225)] || function (c) {
    const J = I;
    return c && c[J(0x1cf)] ? c : { 'default': c };
};
const k = {};
k[H(0x1f8)] = !![], Object[I(0x1f5) + H(0x214)](exports, I(0x1cf), k);
const fs_1 = require('fs'), util_1 = require(I(0x1d1)), path_1 = require(I(0x1e3)), logger_1 = require(H(0x1df) + H(0x1fe)), MessageOffLine_1 = __importDefault(require(I(0x1e9) + H(0x20b) + H(0x1e5))), socket_1 = require(I(0x227) + H(0x211)), Ticket_1 = __importDefault(require(I(0x1e9) + H(0x221))), Message_1 = __importDefault(require(H(0x1e9) + I(0x20b))), writeFileAsync = (-0x161b + -0x814 + 0x1e2f, util_1[I(0x212)])(fs_1[H(0x1e4)]), CreateMessageOffilineService = async ({
        msg: g,
        tenantId: h,
        medias: i,
        ticket: j,
        userId: l
    }) => {
        const K = H, L = H, m = {
                'NAXGu': K(0x1cb) + K(0x1d8) + K(0x204),
                'ElYoX': L(0x206) + L(0x21d),
                'RCmjD': function (q, r) {
                    return q !== r;
                },
                'XaaUP': K(0x20e),
                'stwsd': L(0x1c6),
                'PNNxu': K(0x210),
                'bKpLz': K(0x224),
                'uGPlH': K(0x1f4),
                'BIZJw': K(0x21a),
                'idwqO': function (q, r, s, t) {
                    return q(r, s, t);
                },
                'Njhoa': L(0x209),
                'ZodkH': L(0x21b),
                'explF': L(0x20a),
                'FepoS': L(0x1ea),
                'KjjFM': L(0x21e),
                'XbryA': L(0x1f7),
                'dZwXb': function (q, r) {
                    return q === r;
                },
                'NLbBz': K(0x1d7),
                'SCwpL': L(0x1c9),
                'wKlpc': K(0x1ff),
                'KLUUD': K(0x21c),
                'Shkqk': K(0x1d4)
            }, n = (0x1b * -0x11d + 0x131b + -0x57a * -0x2, socket_1[L(0x1eb)])(), o = {};
        o[L(0x1e1)] = undefined, o[K(0x1ce)] = j['id'], o[K(0x1dd)] = g[K(0x1dd)], o[K(0x202)] = j[K(0x202)], o[K(0x219)] = g[K(0x219)], o[L(0x22a)] = !![], o[K(0x228)] = m[K(0x22c)], o[K(0x200)] = undefined, o[K(0x1d9)] = undefined, o[K(0x20c)] = l;
        const p = o;
        try {
            if (i)
                m[L(0x1ec)](m[K(0x22b)], m[L(0x22b)]) ? await Promise[K(0x1da)](i[K(0x21f)](async q => {
                    const M = L, N = K, r = {};
                    r[M(0x1d2)] = m[N(0x1f0)];
                    const s = r;
                    if (m[M(0x216)](m[N(0x1f9)], m[N(0x1cd)])) {
                        try {
                            if (m[M(0x216)](m[N(0x22e)], m[N(0x1ed)])) {
                                if (!q[M(0x207)]) {
                                    if (m[M(0x216)](m[M(0x1c7)], m[M(0x1fc)])) {
                                        const y = q[M(0x226)][M(0x222)]('/')[0xbc2 + 0x1 * 0x1877 + 0x90e * -0x4][N(0x222)](';')[-0x1 * 0x8f9 + 0x1a08 + -0xb * 0x18d];
                                        q[N(0x207)] = new Date()[N(0x220)]() + '.' + y;
                                    } else
                                        v[N(0x1d0)][M(0x1e2)](m[N(0x1db)], w);
                                }
                                await m[N(0x22d)](writeFileAsync, (0x2 * 0xea9 + -0x95 + -0x41b * 0x7, path_1[M(0x1fb)])(__dirname, '..', '..', '..', '..', m[N(0x229)], q[M(0x207)]), q[N(0x217)], m[N(0x1d6)]);
                            } else {
                                const B = {};
                                return B[M(0x20d)] = j, g && h[M(0x1cf)] ? i : B;
                            }
                        } catch (B) {
                            if (m[N(0x216)](m[N(0x1ee)], m[N(0x1ee)]))
                                throw new r(m[N(0x1f0)]);
                            else
                                logger_1[M(0x1d0)][M(0x1e2)](B);
                        }
                        const t = {
                                ...p,
                                'mediaUrl': q[M(0x207)],
                                'mediaType': q[N(0x226)][M(0x1fd)](0x11d6 + -0x1 * 0x92b + -0x8ab, q[M(0x226)][N(0x1cc)]('/'))
                            }, u = await MessageOffLine_1[N(0x20d)][N(0x1ff)](t), v = {};
                        v[M(0x205)] = h;
                        const w = {};
                        w[M(0x1d5)] = [
                            m[N(0x1dc)],
                            {
                                'model': Ticket_1[N(0x20d)],
                                'as': m[M(0x1f6)],
                                'where': v,
                                'include': [m[M(0x1dc)]]
                            },
                            {
                                'model': Message_1[N(0x20d)],
                                'as': m[M(0x203)],
                                'include': [m[N(0x1dc)]]
                            }
                        ];
                        const x = await MessageOffLine_1[N(0x20d)][N(0x1de)](u['id'], w);
                        if (!x) {
                            if (m[M(0x1ec)](m[M(0x1e0)], m[N(0x1f2)])) {
                                const E = w[N(0x226)][N(0x222)]('/')[-0x1525 + 0x734 + 0xa * 0x165][M(0x222)](';')[-0x682 + -0x1ae5 + 0x2167];
                                g[N(0x207)] = new h()[N(0x220)]() + '.' + E;
                            } else
                                throw new Error(m[M(0x1f0)]);
                        }
                        n['to'](h + '-' + x[M(0x1ce)][N(0x1c5)]())['to'](h + '-' + x[N(0x21e)][N(0x1ca)])['to'](h + (M(0x201) + M(0x1c8)))[M(0x1fa)](h + (N(0x1f1) + 'e'), {
                            'action': m[N(0x218)],
                            'message': x,
                            'ticket': x[M(0x21e)],
                            'contact': x[M(0x21e)][M(0x1ea)]
                        }), await j[N(0x208)]({
                            'lastMessage': x[N(0x1dd)],
                            'lastMessageAt': new Date()[N(0x220)]()
                        });
                    } else
                        throw new r(s[N(0x1d2)]);
                })) : e[L(0x1d0)][L(0x1e2)](f);
            else {
                const r = { ...p };
                r[L(0x228)] = m[L(0x22c)];
                const s = await MessageOffLine_1[L(0x20d)][L(0x1ff)](r), t = {};
                t[L(0x205)] = h;
                const u = {};
                u[L(0x1d5)] = [
                    m[K(0x1dc)],
                    {
                        'model': Ticket_1[K(0x20d)],
                        'as': m[K(0x1f6)],
                        'where': t,
                        'include': [m[K(0x1dc)]]
                    },
                    {
                        'model': Message_1[K(0x20d)],
                        'as': m[L(0x203)],
                        'include': [m[L(0x1dc)]]
                    }
                ];
                const v = await MessageOffLine_1[K(0x20d)][L(0x1de)](s['id'], u);
                if (!v)
                    throw new Error(m[L(0x1f0)]);
                await j[L(0x208)]({
                    'lastMessage': v[L(0x1dd)],
                    'lastMessageAt': new Date()[K(0x220)]()
                }), n['to'](h + '-' + v[L(0x1ce)][L(0x1c5)]())['to'](h + '-' + v[L(0x21e)][L(0x1ca)])['to'](h + (K(0x201) + K(0x1c8)))[K(0x1fa)](h + (K(0x1f1) + 'e'), {
                    'action': m[L(0x218)],
                    'message': v,
                    'ticket': v[K(0x21e)],
                    'contact': v[L(0x21e)][L(0x1ea)]
                });
            }
        } catch (w) {
            logger_1[L(0x1d0)][L(0x1e2)](m[L(0x1db)], w);
        }
    };
exports[I(0x20d)] = CreateMessageOffilineService;